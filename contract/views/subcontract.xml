<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <record id="contract_view_tree_sub" model="ir.ui.view">
            <field name="name">contract_view_tree</field>
            <field name="model">project.contract</field>
            <field name="arch" type="xml">
                <tree string="_tree">
                    <field name="project_id" optional="show"/>
                    <field name="partner_id" optional="show"/>
                    <field name="subcontractor" optional="show"/>
                    <field name="date" optional="show"/>
                    <field name="parent_account_id" optional="show" string="Partner Account"/>
                    <field name="contract" optional="show"/>
                    <field name="down_payment" optional="hide"/>
                    <field name="down_payment_value" optional="hide"/>
                    <field name="referance" optional="hide"/>
                    <!--                    <field name="received_date"/>-->
                </tree>
            </field>
        </record>

<record id="contract_view_form_sub" model="ir.ui.view">
            <field name="name">contract_view_form</field>
            <field name="model">project.contract</field>
            <field name="arch" type="xml">
                <form string="contract_form">
                    <header>
                        <button string="Confirm" name="action_confirm"  invisible="state!='draft'"  type="object"/>
                        <button string="Set Draft" name="action_draft"  invisible="state!='confirm'"  type="object"/>
                        <field name="is_subcontract" invisible="1"/>
                        <button string="create Sub-contract" name="create_subcontract"
                                 invisible="is_subcontract==True or state!='confirm'"  
                                type="object"/>
                        <field name="state" widget="statusbar" statusbar_visible="draft,confirm"/>
                    </header>
                    <sheet>
                        <div class="oe_button_box" name="button_box">
                            <button name="action_view_subcontract" type="object"
                                    class="oe_stat_button">
                                <field name="count_subcontract"/>
                                Sub-contract
                            </button>
                        </div>
                        <h2>
                            <field name="name" readonly="1"/>
                        </h2>
                        <group>
                            <group>
                                <field name="is_subcontract" invisible="1"/>
                                <field name="type" invisible="1"/>
                                <field name="subcontractor" context="{'default_supplier_rank': 1}"
                                        invisible="type!='subconstructor'"  readonly="state!='draft'" required="1"/>
                                <field name="project_id"   readonly="state!='draft'" required="1"/>
                                <field name="partner_id"   readonly="state!='draft'" required="1"/>
                                <field name="date"  readonly="state!='draft'" />
                                <field name="referance"  readonly="state!='draft'" />
                                <field name="type" invisible="1"/>
                            </group>
                            <group>
                                <field name="contract"
                                         invisible="is_subcontract==True"  readonly="state!='draft'" required="1"/>
                                <field name="parent_account_id"  string="Partner Account"
                                         invisible="is_subcontract==True"  />
                                <field name="revenue_account_id"
                                       string="Cost Account"   invisible="is_subcontract==True"  />
                                <field name="received_date"  readonly="state!='draft'" />
                                <field name="down_payment"
                                         invisible="is_subcontract==True"  readonly="state!='draft'"/>
                                <field name="down_payment_value"
                                         invisible="is_subcontract==True"  readonly="state!='draft'"
                                       force_save="1"/>


                            </group>


                        </group>
                        <notebook>
                            <!--                            OWNER PAGE -->

                            <!--                          SUBCONTACTOR PAGE-->
                            <page string="Lines"  >
                                <field name="contarct_line_ids"  readonly="state!='draft'"
                                       widget="section_and_note_one2many">
                                    <tree editable="bottom">
                                        <control>
                                            <create name="add_product_control" string="Add Item"/>
                                            <create name="add_section_control" string="Add a section"
                                                    context="{'default_display_type': 'line_section'}"/>
                                            <create name="add_note_control" string="Add a note"
                                                    context="{'default_display_type': 'line_note'}"/>
                                        </control>
                                        <field name="display_type" invisible="1" optional="show"/>
                                        <field name="is_subcontract" invisible="1" optional="show"/>
                                        <field name="sequence" widget="handle" optional="show"/>



                                                                    <field name="code"/>
                                        <field name="item" string="بند المفايسه"  required="display_type==False"
                                               optional="show" width="100px"/>
                                        <field name="name" string=" وصف بند المفايسه"  required="display_type==False"
                                               widget="section_and_note_text"
                                               optional="show" width="100px"/>
                                        <field name="item_sub_id"  required="display_type==False"
                                               optional="show" width="100px"/>
                                         <field name="desc_item"  required="display_type==False"
                                               optional="show" width="100px"/>
                                        <field name="related_job_id"
                                               optional="show" width="100px"/>
                                        <field name="uom_id"  required="display_type==False"
                                               optional="show" width="100px"/>
                                        <field name="qty"  required="display_type==False"
                                               optional="show" width="100px" sum="total"/>

                                        <field name="price_unit" sum="total" optional="show" width="100px"
                                               force_save="1"/>
                                        <field name="amount_subtotal" sum="total" optional="show" width="100px"/>
                                        <field name="tax_ids" widget="many2many_tags"/>
                                        <field name="amount_tax" sum="total" optional="show" width="100px"/>
                                        <field name="amount_total" sum="total" optional="show" width="100px"/>
                                        <field name="subcontractor"/>
                                        <button name="add_stage" type="object" string="Add Stage"/>
                                    </tree>
                                    <form>
                                        <field name="display_type" invisible="1" optional="show"/>
                                        <field name="sequence" widget="handle" optional="show"/>



                                        <!--                            <field name="parent_item"/>-->
                                        <field name="item" width="100px"/>
                                        <field name="name"  required="display_type==False"

                                               width="100px"/>
                                        <field name="related_job_id"
                                               width="100px"/>
                                        <field name="uom_id" width="100px"/>
                                        <field name="qty"
                                               width="100px"/>

                                        <field name="price_unit" width="100px" readonly="1"
                                               force_save="1"/>
                                        <field name="amount_subtotal" width="100px"/>
                                        <field name="tax_ids" widget="many2many_tags"/>
                                        <field name="amount_tax" width="100px"/>
                                        <field name="amount_total" width="100px"/>


                                    </form>
                                </field>
                                <group class="oe_subtotal_footer oe_right">

                                    <div class="oe_subtotal_footer_separator oe_inline o_td_label">
                                        <label for="amount_total"/>
                                    </div>
                                    <field name="amount_total" nolabel="1" class="oe_subtotal_footer_separator"
                                    />
                                </group>
                            </page>
                            <page string="Deduction">
                                <field name="deduction_ids"  readonly="state!='draft'"
                                       context="{'default_contract_type':type}">
                                    <tree editable="bottom">
                                        <field name="name" required="1"/>
                                        <field name="contract_type" invisible="1"/>
                                        <field name="counterpart_account_id"/>
                                        <field name="is_precentage"/>
                                        <field name="percentage"  readonly="is_precentage==False" 
                                        force_save="1" />
                                        <field name="value"  readonly="is_precentage!=False" 
                                        force_save="1"/>

                                    </tree>
                                </field>

                            </page>
                            <page string="Allowance">
                                <field name="allowance_ids"  readonly="state!='draft'"

                                       context="{'default_contract_type':type}">
                                    <tree editable="bottom">
                                        <field name="name" required="1"/>
                                        <field name="contract_type" invisible="1"/>
                                        <field name="counterpart_account_id"/>
                                        <field name="is_precentage"/>
                                        <field name="percentage"  readonly="is_precentage==False" 
                                         force_save="1"/>
                                        <field name="value"  readonly="is_precentage!=False" 
                                        force_save="1"/>

                                    </tree>
                                </field>

                            </page>
                            <page string="Stages">
                                <field name="stage_ids"  readonly="state!='draft'" >
                                    <tree editable="bottom">
                                        <field name="stage_id"></field>
                                        <field name="prec"></field>
                                    </tree>


                                </field>
                            </page>
                            <page string="Desciption">
                                <field name="description"  readonly="state!='draft'" />
                            </page>

                        </notebook>
                    </sheet>
                    <div class="oe_chatter">
                        <field name="message_follower_ids"/>
                        <field name="activity_ids"/>
                        <field name="message_ids"/>
                    </div>
                </form>
            </field>
        </record>
    </data>
</odoo>